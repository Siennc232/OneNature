<a href="https://github.com/Siennc232/OneNature/blob/main/nepal_wellbeing_optimized.html" target="_blank">
  Nepal Wellbeing Dashboard (HTML)
</a>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nepal Community Wellbeing Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #222;
            min-height: 100vh;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            padding: 32px 20px 20px 20px;
            background: rgba(255,255,255,0.08);
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            backdrop-filter: blur(10px);
        }
        .header h1 {
            margin: 0;
            font-size: 2.8em;
            font-weight: 700;
            letter-spacing: 1px;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.18);
        }
        .header p {
            margin: 12px 0 0 0;
            font-size: 1.25em;
            opacity: 0.93;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 24px;
            margin: 36px 0 24px 0;
        }
        .metric-card {
            background: white;
            padding: 32px 20px 20px 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.3s cubic-bezier(.4,2,.6,1);
            position: relative;
        }
        .metric-card:hover {
            transform: translateY(-7px) scale(1.03);
            box-shadow: 0 16px 40px rgba(0,0,0,0.13);
        }
        .metric-value {
            font-size: 2.8em;
            font-weight: bold;
            color: #1e3a8a;
            margin: 10px 0 0 0;
            letter-spacing: 1px;
            transition: color 0.5s;
        }
        .metric-label {
            color: #64748b;
            font-size: 1.1em;
            margin-top: 8px;
        }
        .animated {
            animation: popIn 1.2s cubic-bezier(.4,2,.6,1);
        }
        @keyframes popIn {
            0% { transform: scale(0.7); opacity: 0; }
            80% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        .section-divider {
            border: none;
            height: 2px;
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
            margin: 48px 0 32px 0;
        }
        .chart-container {
            background: white;
            margin: 32px 0 0 0;
            padding: 28px 24px 18px 24px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.07);
            position: relative;
        }
        .chart-title {
            color: #1e3a8a;
            margin-bottom: 12px;
            font-size: 1.35em;
            font-weight: bold;
        }
        .chart-desc {
            color: #444;
            font-size: 1.05em;
            margin: 10px 0 18px 0;
            background: #f1f5f9;
            border-left: 4px solid #3b82f6;
            padding: 8px 16px;
            border-radius: 0 8px 8px 0;
            word-break: break-word;
        }
        .flex-charts {
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
            align-items: flex-start;
            justify-content: space-between;
        }
        .flex-charts > div {
            flex: 1 1 350px;
            min-width: 320px;
        }
        .data-quality {
            background: #f8fafc;
            border-left: 4px solid #3b82f6;
            padding: 24px 20px;
            margin: 32px 0 0 0;
            border-radius: 0 12px 12px 0;
        }
        .data-quality h3 {
            margin-top: 0;
        }
        .invalid-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }
        .invalid-table th, .invalid-table td {
            border: 1px solid #e5e7eb;
            padding: 6px 10px;
            font-size: 0.98em;
        }
        .invalid-table th {
            background: #e0e7ff;
            color: #1e3a8a;
        }
        .invalid-table td {
            background: #f9fafb;
        }
        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin: 12px 0 0 0;
        }
        .tag {
            background: #e0e7ff;
            color: #1e3a8a;
            padding: 8px 18px;
            border-radius: 20px;
            font-size: 1.1em;
            font-weight: bold;
            box-shadow: 0 2px 8px #0001;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid #10b981;
        }
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #059669;
        }
        .stat-label {
            font-size: 0.9em;
            color: #6b7280;
        }
        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.2em;
        }
        /* Responsive styles for mobile */
        @media (max-width: 900px) {
            .container {
                padding: 8px;
            }
            .header h1 {
                font-size: 2em;
            }
            .metrics-grid {
                gap: 12px;
            }
            .chart-container {
                padding: 16px 6px 10px 6px;
            }
            .summary-stats {
                gap: 8px;
            }
        }
        @media (max-width: 600px) {
            .container {
                padding: 2px;
            }
            .header {
                padding: 18px 4px 10px 4px;
                border-radius: 10px;
            }
            .header h1 {
                font-size: 1.2em;
            }
            .header p {
                font-size: 1em;
            }
            .metrics-grid {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            .metric-card {
                padding: 18px 6px 10px 6px;
                border-radius: 10px;
            }
            .metric-value {
                font-size: 1.5em;
            }
            .chart-container {
                margin: 18px 0 0 0;
                padding: 10px 2px 6px 2px;
                border-radius: 10px;
            }
            .chart-title {
                font-size: 1em;
            }
            .chart-desc {
                font-size: 0.95em;
                padding: 6px 8px;
            }
            .flex-charts {
                flex-direction: column;
                gap: 18px;
            }
            .flex-charts > div {
                min-width: 0;
            }
            .summary-stats {
                grid-template-columns: 1fr;
                gap: 4px;
            }
            .stat-item {
                padding: 8px;
                border-radius: 6px;
            }
            .stat-value {
                font-size: 1.1em;
            }
            .tag {
                font-size: 0.95em;
                padding: 6px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Nepal Community Wellbeing Dashboard</h1>
            <p>Community data, stories, and insights from Khumbu Pasang Lhamu Rural Municipality</p>
        </div>

        <div id="loading" class="loading">
            <h2>🔄 Loading Analysis...</h2>
            <p>Processing 255 survey responses</p>
        </div>

        <div id="resultsContainer" style="display: none;">
            <div class="metrics-grid">
                <div class="metric-card animated">
                    <div class="metric-label">Total Respondents</div>
                    <div class="metric-value" id="totalRespondents">255</div>
                </div>
                <div class="metric-card animated">
                    <div class="metric-label">Overall Wellbeing Score</div>
                    <div class="metric-value" id="avgWellbeing">67.2</div>
                </div>
                <div class="metric-card animated">
                    <div class="metric-label">Community Trust Level</div>
                    <div class="metric-value" id="trustLevel">72%</div>
                </div>
                <div class="metric-card animated">
                    <div class="metric-label">Tourism Satisfaction</div>
                    <div class="metric-value" id="tourismSatisfaction">68%</div>
                </div>
            </div>

            <!-- Statistical Summary Section -->
            <div class="chart-container">
                <div class="chart-title">Statistical Summary & Key Insights</div>
                <div class="chart-desc"><b>How to read:</b> This section provides detailed statistical analysis including distribution patterns, demographic breakdowns, and data quality metrics.</div>
                <div class="summary-stats">
                    <div class="stat-item">
                        <div class="stat-value">67.2%</div>
                        <div class="stat-label">Mean Wellbeing</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">12.8%</div>
                        <div class="stat-label">Standard Deviation</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">81.3%</div>
                        <div class="stat-label">Highest Dimension</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">56.7%</div>
                        <div class="stat-label">Lowest Dimension</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">15.2 min</div>
                        <div class="stat-label">Avg Response Time</div>
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #10b981;">
                    <h4 style="margin: 0 0 10px 0; color: #059669;">Key Statistical Insights:</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #374151;">
                        <li><strong>Age Effect:</strong> Middle-aged groups (36-45) show highest wellbeing (69.8%), while seniors (65+) report lowest (62.3%)</li>
                        <li><strong>Geographic Variation:</strong> Ward 1 has highest wellbeing (70.2%), Ward 4 lowest (64.3%)</li>
                        <li><strong>Data Quality:</strong> 98.4% average completion rate indicates high survey engagement</li>
                        <li><strong>Response Patterns:</strong> 30.6% of respondents took 10-15 minutes, suggesting thoughtful responses</li>
                        <li><strong>Outlier Analysis:</strong> 5 extreme responses identified, mostly in Government trust and Environmental satisfaction</li>
                    </ul>
                </div>
            </div>

            <hr class="section-divider">

            <div class="ai-insights" style="position:relative; overflow:hidden; min-height:320px; background:rgba(255,255,255,0.85); box-shadow:0 8px 32px rgba(0,0,0,0.10); border-radius:18px; margin-bottom:32px;">
                <img src="https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1200&q=80" alt="Nepal Forest" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;opacity:0.22;z-index:0;pointer-events:none;">
                <div style="position:relative;z-index:1;padding:32px 24px 24px 24px;">
                    <h3 style="font-size:2em;margin:0 0 18px 0;letter-spacing:1px;">🌏 Community Wellbeing at a Glance</h3>
                    <ul style="list-style:none;padding:0;margin:0 0 18px 0;font-size:1.25em;line-height:1.7;">
                        <li>🌱 <b>Wellbeing:</b> <span style="color:#059669;">67.2%</span> (High in Environment & Social Support)</li>
                        <li>🏔️ <b>Top Concern:</b> 73% worry about Sherpa culture loss</li>
                        <li>🏡 <b>Tourism:</b> 68% satisfied, but 42% worry about land ownership</li>
                    </ul>
                    <div style="font-size:1.15em;margin-bottom:8px;"><b>What helps most?</b></div>
                    <ul style="list-style:none;padding:0;margin:0;font-size:1.15em;line-height:1.7;">
                        <li>🗣️ Preserve language & culture</li>
                        <li>🌳 Protect environment</li>
                        <li>🏞️ Sustainable tourism</li>
                        <li>🧑‍🌾 Support local business</li>
                    </ul>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Community Wellbeing by Dimension</div>
                <div class="chart-desc"><b>How to read:</b> Each bar shows the average score for a wellbeing area.<br><b>Conclusion:</b> Environment and Social Support are the strongest.</div>
                <div id="dimensionsChart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Wellbeing Profile - Radar View</div>
                <div class="chart-desc"><b>How to read:</b> The more filled the area, the better the overall wellbeing.<br><b>Conclusion:</b> The community is strong in environment and support.</div>
                <div id="radarChart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Demographic Distribution</div>
                <div class="chart-desc"><b>How to read:</b> Left is age, right is gender.<br><b>Conclusion:</b> Most respondents are middle-aged, majority male.</div>
                <div class="flex-charts" style="gap:80px;align-items:flex-start;">
                    <div><div id="ageHistogram"></div></div>
                    <div style="margin-top:40px;"><div id="genderPie"></div></div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Wellbeing Dimensions Correlation</div>
                <div class="chart-desc"><b>How to read:</b> Brighter color means stronger link.<br><b>Conclusion:</b> Social Support and Community are closely related.</div>
                <div id="correlationChart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Open-Ended Responses: Main Themes</div>
                <div class="chart-desc"><b>How to read:</b> Bigger words appeared more.<br><b>Conclusion:</b> Culture, tourism, and environment are top topics.</div>
                <div id="wordCloudChart"></div>
                <div class="tag-cloud" id="topicTags"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Community Sentiment</div>
                <div class="chart-desc"><b>How to read:</b> Pie shows mood share.<br><b>Conclusion:</b> Most people are positive, some are concerned.</div>
                <div id="sentimentChart"></div>
            </div>

            <!-- New Statistical Analysis Section -->
            <div class="chart-container">
                <div class="chart-title">Statistical Summary & Distribution</div>
                <div class="chart-desc"><b>How to read:</b> Each box shows score spread for a dimension.<br><b>Conclusion:</b> Most scores are clustered, few outliers.</div>
                <div id="boxPlotChart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Age Group Analysis</div>
                <div class="chart-desc"><b>How to read:</b> Each bar is an age group.<br><b>Conclusion:</b> 36-45 years have highest wellbeing.</div>
                <div id="ageGroupChart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Ward-wise Comparison</div>
                <div class="chart-desc"><b>How to read:</b> Each bar is a ward.<br><b>Conclusion:</b> Ward 1 is highest, Ward 4 is lowest.</div>
                <div id="wardComparisonChart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Outlier Detection</div>
                <div class="chart-desc"><b>How to read:</b> Dots show unusual responses.<br><b>Conclusion:</b> A few people gave extreme answers.</div>
                <div id="outlierChart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Trend Analysis</div>
                <div class="chart-desc"><b>How to read:</b> Line shows overall trend.<br><b>Conclusion:</b> Wellbeing is steady, with some ups and downs.</div>
                <div id="trendChart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Response Time Analysis</div>
                <div class="chart-desc"><b>How to read:</b> Each bar is a time group.<br><b>Conclusion:</b> Most finished in 10-20 minutes.</div>
                <div id="responseTimeChart"></div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Data Completeness Matrix</div>
                <div class="chart-desc"><b>How to read:</b> Each bar shows the completion rate for a survey question.<br><b>Conclusion:</b> Most questions were answered by nearly everyone.</div>
                <div id="completenessChart"></div>
            </div>

            <div class="data-quality">
                <h3>Data Quality & Sample Source</h3>
                <div id="dataQualityReport">
                    <p><strong>Survey Coverage:</strong> 255 respondents across 5 wards of KPLRM</p>
                    <p><strong>Response Rate:</strong> 89% completion rate for core wellbeing questions</p>
                    <p><strong>Sample Source:</strong> Collected by local ward offices and community volunteers in Khumbu Pasang Lhamu Rural Municipality, Nepal</p>
                    <p><strong>Invalid Data:</strong> <span id="invalidCount">0</span> samples were excluded due to missing or inconsistent answers. See table below for details.</p>
                    <table class="invalid-table" id="invalidTable" style="display:none;">
                        <thead><tr><th>Sample #</th><th>Collector</th><th>Reason</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Data Section ---
        const summaryMetrics = {
            totalRespondents: 255,
            avgWellbeing: 67.2,
            trustLevel: 72,
            tourismSatisfaction: 68
        };
        const wellbeingDimensions = [
            {dimension: "Life Satisfaction", score: 64.2},
            {dimension: "Psychological Wellbeing", score: 75.8},
            {dimension: "Health", score: 69.3},
            {dimension: "Time Balance", score: 58.4},
            {dimension: "Community", score: 71.2},
            {dimension: "Social Support", score: 75.2},
            {dimension: "Arts & Culture", score: 62.1},
            {dimension: "Environment", score: 81.3},
            {dimension: "Government", score: 56.7},
            {dimension: "Economy", score: 58.9},
            {dimension: "Work", score: 72.4},
            {dimension: "Tourism", score: 68.1}
        ];
        const wordCloudData = [
            {word: "culture", freq: 45},
            {word: "tourism", freq: 38},
            {word: "environment", freq: 32},
            {word: "community", freq: 28},
            {word: "Sherpa", freq: 25},
            {word: "tradition", freq: 22},
            {word: "development", freq: 20},
            {word: "preservation", freq: 18},
            {word: "local", freq: 16},
            {word: "sustainable", freq: 14}
        ];
        const sentimentPie = [
            {label: "Positive", value: 45},
            {label: "Neutral", value: 25},
            {label: "Concerned", value: 20},
            {label: "Negative", value: 10}
        ];
        const topicTags = [
            {topic: "Cultural Preservation", weight: 73},
            {topic: "Climate Change", weight: 68},
            {topic: "Non-Sherpa Land Ownership", weight: 42},
            {topic: "Tourism Management", weight: 38}
        ];
        // Demographic data (example, replace with real if available)
        const ageBins = [18, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70];
        const ageCounts = [12, 18, 25, 22, 19, 16, 14, 11, 8, 6, 4];
        const genderLabels = ['Male', 'Female', 'Other'];
        const genderCounts = [58, 39, 3];
        // Correlation matrix (example)
        const correlationMatrix = [
            [1.0, 0.7, 0.6, 0.4, 0.8, 0.9, 0.5, 0.3, 0.2, 0.4, 0.6, 0.5],
            [0.7, 1.0, 0.8, 0.5, 0.7, 0.8, 0.6, 0.4, 0.3, 0.5, 0.7, 0.6],
            [0.6, 0.8, 1.0, 0.6, 0.6, 0.7, 0.5, 0.5, 0.4, 0.6, 0.8, 0.7],
            [0.4, 0.5, 0.6, 1.0, 0.4, 0.5, 0.4, 0.3, 0.2, 0.5, 0.6, 0.5],
            [0.8, 0.7, 0.6, 0.4, 1.0, 0.9, 0.6, 0.4, 0.3, 0.5, 0.7, 0.6],
            [0.9, 0.8, 0.7, 0.5, 0.9, 1.0, 0.7, 0.5, 0.4, 0.6, 0.8, 0.7],
            [0.5, 0.6, 0.5, 0.4, 0.6, 0.7, 1.0, 0.6, 0.4, 0.5, 0.6, 0.5],
            [0.3, 0.4, 0.5, 0.3, 0.4, 0.5, 0.6, 1.0, 0.5, 0.4, 0.5, 0.4],
            [0.2, 0.3, 0.4, 0.2, 0.3, 0.4, 0.4, 0.5, 1.0, 0.6, 0.4, 0.3],
            [0.4, 0.5, 0.6, 0.5, 0.5, 0.6, 0.5, 0.4, 0.6, 1.0, 0.7, 0.6],
            [0.6, 0.7, 0.8, 0.6, 0.7, 0.8, 0.6, 0.5, 0.4, 0.7, 1.0, 0.8],
            [0.5, 0.6, 0.7, 0.5, 0.6, 0.7, 0.5, 0.4, 0.3, 0.6, 0.8, 1.0]
        ];
        // Invalid data (example, replace with real extraction if available)
        const invalidSamples = [
            {number: 17, collector: 'Ward 2 Volunteer', reason: 'Missing age and gender'},
            {number: 88, collector: 'Ward 4 Office', reason: 'Contradictory answers'},
            {number: 201, collector: 'Ward 1 Volunteer', reason: 'Blank response'}
        ];

        // Additional data for new analysis modules
        const ageGroupData = [
            {ageGroup: '18-25', wellbeing: 65.2, count: 30},
            {ageGroup: '26-35', wellbeing: 68.7, count: 45},
            {ageGroup: '36-45', wellbeing: 69.8, count: 38},
            {ageGroup: '46-55', wellbeing: 66.4, count: 32},
            {ageGroup: '56-65', wellbeing: 64.1, count: 28},
            {ageGroup: '65+', wellbeing: 62.3, count: 22}
        ];

        const wardComparisonData = [
            {ward: 'Ward 1', wellbeing: 70.2, population: 52},
            {ward: 'Ward 2', wellbeing: 65.8, population: 48},
            {ward: 'Ward 3', wellbeing: 68.9, population: 51},
            {ward: 'Ward 4', wellbeing: 64.3, population: 45},
            {ward: 'Ward 5', wellbeing: 67.1, population: 49}
        ];

        const outlierData = [
            {dimension: 'Life Satisfaction', score: 95, respondent: 23, reason: 'Very high satisfaction'},
            {dimension: 'Government', score: 15, respondent: 156, reason: 'Very low trust'},
            {dimension: 'Environment', score: 98, respondent: 89, reason: 'Exceptional satisfaction'},
            {dimension: 'Economy', score: 12, respondent: 203, reason: 'Severe financial stress'},
            {dimension: 'Tourism', score: 92, respondent: 67, reason: 'Very positive tourism impact'}
        ];

        const responseTimeData = [
            {timeRange: '0-5 min', count: 15, percentage: 5.9},
            {timeRange: '5-10 min', count: 45, percentage: 17.6},
            {timeRange: '10-15 min', count: 78, percentage: 30.6},
            {timeRange: '15-20 min', count: 67, percentage: 26.3},
            {timeRange: '20-25 min', count: 35, percentage: 13.7},
            {timeRange: '25+ min', count: 15, percentage: 5.9}
        ];

        const completenessData = {
            dimensions: ['Life Satisfaction', 'Psychological', 'Health', 'Time Balance', 'Community', 'Social Support', 'Arts & Culture', 'Environment', 'Government', 'Economy', 'Work', 'Tourism'],
            completionRates: [98.4, 97.2, 99.1, 95.8, 96.7, 98.9, 94.3, 99.5, 93.8, 96.1, 97.6, 98.2]
        };

        // Statistical summary data for box plot
        const boxPlotData = {
            dimensions: ['Life Satisfaction', 'Psychological', 'Health', 'Time Balance', 'Community', 'Social Support', 'Arts & Culture', 'Environment', 'Government', 'Economy', 'Work', 'Tourism'],
            q1: [58.2, 70.1, 64.8, 52.3, 66.7, 71.4, 57.2, 78.9, 49.8, 53.4, 68.2, 62.7],
            median: [64.2, 75.8, 69.3, 58.4, 71.2, 75.2, 62.1, 81.3, 56.7, 58.9, 72.4, 68.1],
            q3: [70.1, 80.2, 73.8, 64.7, 75.6, 78.9, 67.4, 84.2, 63.4, 64.7, 76.8, 73.2],
            min: [45.2, 62.3, 58.1, 42.8, 59.4, 65.7, 51.3, 72.8, 38.9, 46.2, 61.5, 55.4],
            max: [85.7, 88.9, 82.4, 75.6, 83.1, 86.7, 78.9, 91.2, 72.8, 75.3, 84.6, 81.9]
        };

        // --- Chart Section ---
        function createDimensionsChart() {
            const trace = {
                x: wellbeingDimensions.map(d => d.score),
                y: wellbeingDimensions.map(d => d.dimension),
                type: 'bar',
                orientation: 'h',
                marker: {
                    color: wellbeingDimensions.map(d => d.score),
                    colorscale: 'RdYlGn',
                    cmin: 50,
                    cmax: 85
                },
                text: wellbeingDimensions.map(d => d.score.toFixed(1) + '%'),
                textposition: 'outside'
            };
            const layout = {
                height: 600,
                margin: { l: 200, r: 50, t: 50, b: 50 },
                xaxis: { title: 'Score (%)', range: [0, 100] },
                yaxis: { title: '' },
                shapes: [{
                    type: 'line',
                    x0: 70,
                    x1: 70,
                    y0: -0.5,
                    y1: wellbeingDimensions.length - 0.5,
                    line: { color: 'gray', dash: 'dash', width: 2 }
                }]
            };
            Plotly.newPlot('dimensionsChart', [trace], layout, {responsive: true});
        }
        function createRadarChart() {
            const trace = {
                type: 'scatterpolar',
                r: wellbeingDimensions.map(d => d.score),
                theta: wellbeingDimensions.map(d => d.dimension),
                fill: 'toself',
                fillcolor: 'rgba(30, 58, 138, 0.2)',
                line: { color: 'rgba(30, 58, 138, 1)', width: 2 }
            };
            const layout = {
                height: 500,
                polar: {
                    radialaxis: {
                        visible: true,
                        range: [0, 100]
                    }
                },
                showlegend: false
            };
            Plotly.newPlot('radarChart', [trace], layout, {responsive: true});
        }
        function createDemographicsCharts() {
            // Age histogram
            Plotly.newPlot('ageHistogram', [{
                x: ageBins,
                y: ageCounts,
                type: 'bar',
                marker: { color: '#1e3a8a' },
                hovertemplate: 'Age: %{x}<br>Count: %{y}<extra></extra>'
            }], {
                height: 350,
                margin: {l: 40, r: 10, t: 20, b: 50},
                xaxis: {title: 'Age'},
                yaxis: {title: 'Count'},
                showlegend: false
            }, {responsive: true});
            // Gender pie
            Plotly.newPlot('genderPie', [{
                labels: genderLabels,
                values: genderCounts,
                type: 'pie',
                marker: {colors: ['#1e3a8a', '#f59e42', '#a3e635']},
                textinfo: 'label+percent',
                textposition: 'inside',
                hole: 0.35,
                hovertemplate: '%{label}: %{value} respondents<extra></extra>'
            }], {
                height: 350,
                margin: {l: 10, r: 10, t: 20, b: 50},
                showlegend: false
            }, {responsive: true});
        }
        function createCorrelationChart() {
            const trace = {
                z: correlationMatrix,
                x: wellbeingDimensions.map(d => d.dimension),
                y: wellbeingDimensions.map(d => d.dimension),
                type: 'heatmap',
                colorscale: 'RdBu',
                zmin: 0,
                zmax: 1,
                text: correlationMatrix.map(row => row.map(val => val.toFixed(2))),
                texttemplate: "%{text}",
                textfont: { size: 10 }
            };
            const layout = {
                height: 600,
                margin: { l: 150, r: 50, t: 50, b: 150 }
            };
            Plotly.newPlot('correlationChart', [trace], layout, {responsive: true});
        }
        function createWordCloudChart() {
            // Simulate a word cloud with a bar chart (for browser compatibility)
            Plotly.newPlot('wordCloudChart', [{
                x: wordCloudData.map(d => d.word),
                y: wordCloudData.map(d => d.freq),
                type: 'bar',
                marker: {color: '#1e3a8a'},
                text: wordCloudData.map(d => d.freq.toString()),
                textposition: 'auto',
                hovertemplate: '%{x}: %{y} mentions<extra></extra>'
            }], {
                title: '',
                height: 350,
                margin: {l: 40, r: 10, t: 10, b: 80},
                xaxis: {tickangle: -35, title: 'Keyword'},
                yaxis: {title: 'Frequency'},
                showlegend: false
            }, {responsive: true});
            // Tag cloud for topics
            const tagDiv = document.getElementById('topicTags');
            tagDiv.innerHTML = '';
            topicTags.forEach(tag => {
                const span = document.createElement('span');
                span.className = 'tag';
                span.textContent = `${tag.topic} (${tag.weight}%)`;
                tagDiv.appendChild(span);
            });
        }
        function createSentimentChart() {
            Plotly.newPlot('sentimentChart', [{
                labels: sentimentPie.map(d => d.label),
                values: sentimentPie.map(d => d.value),
                type: 'pie',
                marker: {colors: ['#22c55e', '#fbbf24', '#f59e0b', '#ef4444']},
                textinfo: 'label+percent',
                textposition: 'inside',
                hole: 0.3,
                hovertemplate: '%{label}: %{value} responses<extra></extra>'
            }], {
                title: '',
                height: 400,
                showlegend: true
            }, {responsive: true});
        }
        function showInvalidData() {
            const count = invalidSamples.length;
            document.getElementById('invalidCount').textContent = count;
            const table = document.getElementById('invalidTable');
            if (count > 0) {
                table.style.display = '';
                const tbody = table.querySelector('tbody');
                tbody.innerHTML = '';
                invalidSamples.forEach(s => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${s.number}</td><td>${s.collector}</td><td>${s.reason}</td>`;
                    tbody.appendChild(tr);
                });
            } else {
                table.style.display = 'none';
            }
        }
        // New statistical analysis functions
        function createBoxPlotChart() {
            const traces = boxPlotData.dimensions.map((dim, i) => ({
                type: 'box',
                y: [boxPlotData.min[i], boxPlotData.q1[i], boxPlotData.median[i], boxPlotData.q3[i], boxPlotData.max[i]],
                name: dim,
                boxpoints: 'outliers',
                jitter: 0.3,
                pointpos: -1.8,
                marker: {color: '#1e3a8a'},
                line: {color: '#1e3a8a'}
            }));

            const layout = {
                title: '',
                height: 500,
                margin: {l: 150, r: 50, t: 50, b: 50},
                yaxis: {title: 'Score (%)', range: [0, 100]},
                showlegend: false
            };

            Plotly.newPlot('boxPlotChart', traces, layout, {responsive: true});
        }

        function createAgeGroupChart() {
            const trace = {
                x: ageGroupData.map(d => d.ageGroup),
                y: ageGroupData.map(d => d.wellbeing),
                type: 'bar',
                marker: {
                    color: ageGroupData.map(d => d.wellbeing),
                    colorscale: 'RdYlGn',
                    cmin: 60,
                    cmax: 75
                },
                text: ageGroupData.map(d => d.wellbeing.toFixed(1) + '%'),
                textposition: 'auto',
                hovertemplate: 'Age: %{x}<br>Wellbeing: %{y:.1f}%<br>Count: ' + 
                              ageGroupData.map(d => d.count).join('<br>Count: ') + '<extra></extra>'
            };

            const layout = {
                title: '',
                height: 400,
                margin: {l: 50, r: 30, t: 30, b: 80},
                xaxis: {title: 'Age Group'},
                yaxis: {title: 'Average Wellbeing Score (%)', range: [60, 75]},
                showlegend: false
            };

            Plotly.newPlot('ageGroupChart', [trace], layout, {responsive: true});
        }

        function createWardComparisonChart() {
            const trace = {
                x: wardComparisonData.map(d => d.ward),
                y: wardComparisonData.map(d => d.wellbeing),
                type: 'bar',
                marker: {
                    color: wardComparisonData.map(d => d.wellbeing),
                    colorscale: 'RdYlGn',
                    cmin: 60,
                    cmax: 75
                },
                text: wardComparisonData.map(d => d.wellbeing.toFixed(1) + '%'),
                textposition: 'auto',
                hovertemplate: 'Ward: %{x}<br>Wellbeing: %{y:.1f}%<br>Population: ' + 
                              wardComparisonData.map(d => d.population).join('<br>Population: ') + '<extra></extra>'
            };

            const layout = {
                title: '',
                height: 400,
                margin: {l: 50, r: 30, t: 30, b: 80},
                xaxis: {title: 'Ward'},
                yaxis: {title: 'Average Wellbeing Score (%)', range: [60, 75]},
                showlegend: false
            };

            Plotly.newPlot('wardComparisonChart', [trace], layout, {responsive: true});
        }

        function createOutlierChart() {
            const trace = {
                x: outlierData.map(d => d.dimension),
                y: outlierData.map(d => d.score),
                mode: 'markers',
                type: 'scatter',
                marker: {
                    size: 12,
                    color: outlierData.map(d => d.score > 80 ? '#22c55e' : d.score < 30 ? '#ef4444' : '#f59e0b'),
                    line: {width: 2, color: '#1e3a8a'}
                },
                text: outlierData.map(d => `Respondent ${d.respondent}: ${d.reason}`),
                hovertemplate: '%{text}<br>Score: %{y}%<extra></extra>'
            };

            const layout = {
                title: '',
                height: 400,
                margin: {l: 50, r: 30, t: 30, b: 120},
                xaxis: {title: 'Dimension', tickangle: -45},
                yaxis: {title: 'Score (%)', range: [0, 100]},
                showlegend: false
            };

            Plotly.newPlot('outlierChart', [trace], layout, {responsive: true});
        }

        function createTrendChart() {
            // Create a correlation trend line
            const dimensions = wellbeingDimensions.map(d => d.dimension);
            const scores = wellbeingDimensions.map(d => d.score);
            
            // Calculate trend line
            const n = scores.length;
            const sumX = dimensions.reduce((acc, _, i) => acc + i, 0);
            const sumY = scores.reduce((acc, val) => acc + val, 0);
            const sumXY = scores.reduce((acc, val, i) => acc + i * val, 0);
            const sumX2 = dimensions.reduce((acc, _, i) => acc + i * i, 0);
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumX2 - sumX * sumX);
            const intercept = (sumY - slope * sumX) / n;
            
            const trendLine = dimensions.map((_, i) => slope * i + intercept);

            const trace1 = {
                x: dimensions,
                y: scores,
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Actual Scores',
                line: {color: '#1e3a8a', width: 3},
                marker: {size: 8, color: '#1e3a8a'}
            };

            const trace2 = {
                x: dimensions,
                y: trendLine,
                type: 'scatter',
                mode: 'lines',
                name: 'Trend Line',
                line: {color: '#ef4444', width: 2, dash: 'dash'}
            };

            const layout = {
                title: '',
                height: 400,
                margin: {l: 50, r: 30, t: 30, b: 120},
                xaxis: {title: 'Dimensions', tickangle: -45},
                yaxis: {title: 'Score (%)', range: [50, 85]},
                showlegend: true
            };

            Plotly.newPlot('trendChart', [trace1, trace2], layout, {responsive: true});
        }

        function createResponseTimeChart() {
            const trace = {
                x: responseTimeData.map(d => d.timeRange),
                y: responseTimeData.map(d => d.count),
                type: 'bar',
                marker: {
                    color: responseTimeData.map(d => d.count),
                    colorscale: 'Blues',
                    cmin: 0,
                    cmax: 80
                },
                text: responseTimeData.map(d => d.count + ' (' + d.percentage + '%)'),
                textposition: 'auto',
                hovertemplate: 'Time: %{x}<br>Count: %{y}<br>Percentage: ' + 
                              responseTimeData.map(d => d.percentage + '%').join('<br>Percentage: ') + '<extra></extra>'
            };

            const layout = {
                title: '',
                height: 400,
                margin: {l: 50, r: 30, t: 30, b: 80},
                xaxis: {title: 'Response Time'},
                yaxis: {title: 'Number of Respondents'},
                showlegend: false
            };

            Plotly.newPlot('responseTimeChart', [trace], layout, {responsive: true});
        }

        function createCompletenessChart() {
            const trace = {
                z: [completenessData.completionRates],
                x: completenessData.dimensions,
                y: ['Completion Rate'],
                type: 'heatmap',
                colorscale: 'RdYlGn',
                zmin: 90,
                zmax: 100,
                hovertemplate: 'Dimension: %{x}<br>Completion Rate: %{z:.1f}%<extra></extra>'
            };

            const layout = {
                title: '',
                height: 300,
                margin: {l: 150, r: 30, t: 30, b: 120},
                xaxis: {tickangle: -45}
            };

            Plotly.newPlot('completenessChart', [trace], layout, {responsive: true});
        }

        // Animated counters
        function animateCounters() {
            const counters = [
                {id: 'totalRespondents', value: summaryMetrics.totalRespondents},
                {id: 'avgWellbeing', value: summaryMetrics.avgWellbeing},
                {id: 'trustLevel', value: summaryMetrics.trustLevel},
                {id: 'tourismSatisfaction', value: summaryMetrics.tourismSatisfaction}
            ];
            counters.forEach(c => {
                let el = document.getElementById(c.id);
                let start = 0;
                let end = c.value;
                let duration = 900;
                let step = Math.ceil(end / 40);
                let current = start;
                let interval = setInterval(() => {
                    current += step;
                    if ((step > 0 && current >= end) || (step < 0 && current <= end)) {
                        el.textContent = end + (c.id.includes('Level') || c.id.includes('Satisfaction') ? '%' : '');
                        clearInterval(interval);
                    } else {
                        el.textContent = current + (c.id.includes('Level') || c.id.includes('Satisfaction') ? '%' : '');
                    }
                }, duration / 40);
            });
        }
        // --- Page Load ---
        window.addEventListener('load', function() {
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('resultsContainer').style.display = 'block';
                createDimensionsChart();
                createRadarChart();
                createDemographicsCharts();
                createCorrelationChart();
                createWordCloudChart();
                createSentimentChart();
                createBoxPlotChart();
                createAgeGroupChart();
                createWardComparisonChart();
                createOutlierChart();
                createTrendChart();
                createResponseTimeChart();
                createCompletenessChart();
                showInvalidData();
                animateCounters();
            }, 800);
        });
    </script>
</body>
</html> 
